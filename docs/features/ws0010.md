# WS0010 OLED Driver {#ws0010-oled-driver}

## Supported Hardware {#supported-hardware}

OLED modules using [WS0010](https://surenoo.tech/download/03_SOL/0301_SOC/SOC1602E.pdf) IC or equivalent, communicating in 4-bit mode.
Some display modules need small jumpers soldered to use 4 bit mode (usually 16 pin modules). Others have pins you can pull high or low to change interface (usually 20 pin modules). The linked module is a 14 pin module and it's interface is determined through the driver. This is the supported module. If you're using another module and it's not working check the function set command in ws0010.h and compare it to the datasheet of your display.

|Module|Size          |Notes                            |
|------|--------------|---------------------------------|
|1602A |16x2, 5x8 dots|                                 |
|2004A |20x4, 5x8 dots|Untested, not currently supported|


## Usage {#usage}

Add the following to your `rules.mk`:

```make
WS0010_ENABLE = yes
```

## Basic Configuration {#basic-configuration}

Add the following to your `config.h`:

|Define                 |Default       |Description                                                                                          |
|-----------------------|--------------|-----------------------------------------------------------------------------------------------------|
|`WS0010_DATA_PINS`    |*Not defined* |(Required) An array of four GPIO pins connected to the display's D4-D7 pins, eg. `{ B1, B3, B2, B6 }`|
|`WS0010_RS_PIN`       |*Not defined* |(Required) The GPIO connected to the display's RS pin                                                |
|`WS0010_RW_PIN`       |*Not defined* |(Required) The GPIO connected to the display's RW pin                                                |
|`WS0010_E_PIN`        |*Not defined* |(Required) The GPIO connected to the display's E pin                                                 |
|`WS0010_DISPLAY_COLS` |`16`          |The number of visible characters on a single line of the display                                     |
|`WS0010_DISPLAY_LINES`|`2`           |The number of visible lines on the display                                                           |

## Examples {#examples}

### Hello World {#example-hello-world}

Add the following to your `keymap.c`:

```c
void keyboard_post_init_user(void) {
    ws0010_init(true, true, false); // Show blinking cursor
    ws0010_puts_P(PSTR("Hello, world!\n"));
}
```

### Custom Character Definition {#example-custom-character}

Up to eight custom characters can be defined. This data is stored in the Character Generator RAM (CGRAM), and is not persistent across power cycles.

This example defines the QMK Psi as the first custom character. The first 16 positions in the character set are reserved for the eight custom characters duplicated.

```
Byte |      16 8 4 2 1
   1 | x x x ■ □ ■ □ ■
   2 | x x x ■ □ ■ □ ■
   3 | x x x ■ □ ■ □ ■
   4 | x x x □ ■ ■ ■ □
   5 | x x x □ □ ■ □ □
   6 | x x x □ □ ■ □ □
   7 | x x x □ □ ■ □ □
   8 | x x x □ □ □ □ □
```

```c
uint8_t PROGMEM psi[8] = { 0x15, 0x15, 0x15, 0x0E, 0x04, 0x04, 0x04, 0x00 };

void keyboard_post_init_user(void) {
    ws0010_init(false, false, false);
    ws0010_define_char_P(0, psi);
    // Cursor is incremented while defining characters so must be reset
    ws0010_home();
    // 0x08 to avoid null terminator
    ws0010_puts_P(PSTR("\x08 QMK Firmware"));
}
```

## API {#api}

### `void ws0010_init(bool cursor, bool blink)` {#api-ws0010-init}

Initialize the display.

This function should be called only once, before any of the other functions can be called.

#### Arguments {#api-ws0010-init-arguments}

 - `bool cursor`  
   Whether to show the cursor.
 - `bool blink`  
   Whether to blink the cursor, if shown.
 - `bool shift`  
   Whether to display right to left instead of left to right.

---

### `void ws0010_clear(void)` {#api-ws0010-clear}

Clear the display.

This function is called on init.

---

### `void ws0010_home(void)` {#api-ws0010-home}

Move the cursor to the home position.

This function is called on init.

---

### `void ws0010_on(bool cursor, bool blink)` {#api-ws0010-on}

Turn the display on, and/or set the cursor properties.

This function is called on init.

#### Arguments {#api-ws0010-on-arguments}

 - `bool cursor`  
   Whether to show the cursor.
 - `bool blink`  
   Whether to blink the cursor, if shown.

---

### `void ws0010_off(void)` {#api-ws0010-off}

Turn the display off.

---

### `void ws0010_set_cursor(uint8_t col, uint8_t line)` {#api-ws0010-set-cursor}

Move the cursor to the specified position on the display.

#### Arguments {#api-ws0010-set-cursor-arguments}

 - `uint8_t col`  
   The column number to move to, from 0 to 15 on 16x2 displays.
 - `bool line`  
   The line number to move to, either 0 or 1 on 16x2 displays.

---

### `void ws0010_putc(char c)` {#api-ws0010-putc}

Print a character to the display. The newline character `\n` will move the cursor to the start of the next line.

The exact character shown may depend on the ROM code of your particular display - refer to the datasheet for the full character set.

#### Arguments {#api-ws0010-putc-arguments}

 - `char c`  
   The character to print.

---

### `void ws0010_puts(const char *s)` {#api-ws0010-puts}

Print a string of characters to the display.

#### Arguments {#api-ws0010-puts-arguments}

 - `const char *s`  
   The string to print.

---

### `void ws0010_puts_P(const char *s)` {#api-ws0010-puts-p}

Print a string of characters from PROGMEM to the display.

On ARM devices, this function is simply an alias of `ws0010_puts()`.

#### Arguments {#api-ws0010-puts-p-arguments}

 - `const char *s`  
   The PROGMEM string to print (ie. `PSTR("Hello")`).

---

### `void ws0010_define_char(uint8_t index, uint8_t *data)` {#api-ws0010-define-char}

Define a custom character.

#### Arguments {#api-ws0010-define-char-arguments}

 - `uint8_t index`  
   The index of the custom character to define, from 0 to 7.
 - `uint8_t *data`  
   An array of 8 bytes containing the 5-bit row data of the character, where the first byte is the topmost row, and the least significant bit of each byte is the rightmost column.

---

### `void ws0010_define_char_P(uint8_t index, const uint8_t *data)` {#api-ws0010-define-char-p}

Define a custom character from PROGMEM.

On ARM devices, this function is simply an alias of `ws0010_define_char()`.

#### Arguments {#api-ws0010-define-char-p-arguments}

 - `uint8_t index`  
   The index of the custom character to define, from 0 to 7.
 - `const uint8_t *data`  
   A PROGMEM array of 8 bytes containing the 5-bit row data of the character, where the first byte is the topmost row, and the least significant bit of each byte is the rightmost column.

---

### `bool ws0010_busy(void)` {#api-ws0010-busy}

Indicates whether the display is currently processing, and cannot accept instructions.

#### Return Value {#api-ws0010-busy-arguments}

`true` if the display is busy.

---

### `void ws0010_write(uint8_t data, bool isData)` {#api-ws0010-write}

Write a byte to the display.

#### Arguments {#api-ws0010-write-arguments}

 - `uint8_t data`  
   The byte to send to the display.
 - `bool isData`  
   Whether the byte is an instruction or character data.

---

### `uint8_t ws0010_read(bool isData)` {#api-ws0010-read}

Read a byte from the display.

#### Arguments {#api-ws0010-read-arguments}

 - `bool isData`  
   Whether to read the current cursor position, or the character at the cursor.

#### Return Value {#api-ws0010-read-return}

If `isData` is `true`, the returned byte will be the character at the current DDRAM address. Otherwise, it will be the current DDRAM address and the busy flag.

---

### `void ws0010_command(uint8_t command)` {#api-ws0010-command}

Send a command to the display. Refer to the datasheet and `ws0010.h` for the valid commands and defines.

This function waits for the display to clear the busy flag before sending the command.

#### Arguments {#api-ws0010-command-arguments}

 - `uint8_t command`  
   The command to send.

---

### `void ws0010_data(uint8_t data)` {#api-ws0010-data}

Send a byte of data to the display.

This function waits for the display to clear the busy flag before sending the data.

#### Arguments {#api-ws0010-data-arguments}

 - `uint8_t data`  
   The byte of data to send.

---

### `void ws0010_set_cgram_address(uint8_t address)` {#api-ws0010-set-cgram-address}

Set the CGRAM address.

This function is used when defining custom characters.

#### Arguments {#api-ws0010-set-cgram-address-arguments}

 - `uint8_t address`  
   The CGRAM address to move to, from `0x00` to `0x3F`.

---

### `void ws0010_set_ddram_address(uint8_t address)` {#api-ws0010-set-ddram-address}

Set the DDRAM address.

This function is used when printing characters to the display, and setting the cursor.

#### Arguments {#api-ws0010-set-ddram-address-arguments}

 - `uint8_t address`  
   The DDRAM address to move to, from `0x00` to `0x7F`.
